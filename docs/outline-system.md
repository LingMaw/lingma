# å¤§çº²ç³»ç»Ÿ

> ä»¥æ ‘çŠ¶ç»“æ„ç»„ç»‡å°è¯´çš„æ•´ä½“æ¡†æ¶å’Œæƒ…èŠ‚è„‰ç»œ

---

## ğŸ“– ç³»ç»Ÿæ¦‚è¿°

å¤§çº²ç³»ç»Ÿé‡‡ç”¨æ ‘çŠ¶ç»“æ„ç®¡ç†å°è¯´çš„æ•´ä½“æ¡†æ¶ï¼Œæ”¯æŒå·ã€ç« ã€å°èŠ‚ä¸‰å±‚å±‚çº§ã€‚é€šè¿‡ AI è¾…åŠ©ï¼Œç”¨æˆ·å¯ä»¥å¿«é€Ÿç”Ÿæˆå®Œæ•´å¤§çº²æˆ–ç»­å†™åç»­æƒ…èŠ‚ï¼Œå¹¶é€šè¿‡æ‹–æ‹½äº¤äº’è‡ªç”±è°ƒæ•´ç»“æ„ã€‚

---

## ğŸ¯ åŠŸèƒ½ç‰¹æ€§

### 1. ä¸‰å±‚æ ‘çŠ¶ç»“æ„

```
é¡¹ç›® (NovelProject)
    â”‚
    â”œâ”€â”€ å· (Volume) - ç¬¬ä¸€å±‚
    â”‚     â”‚
    â”‚     â”œâ”€â”€ ç«  (Chapter) - ç¬¬äºŒå±‚
    â”‚     â”‚     â”‚
    â”‚     â”‚     â”œâ”€â”€ å°èŠ‚ (Section) - ç¬¬ä¸‰å±‚
    â”‚     â”‚     â””â”€â”€ å°èŠ‚ (Section)
    â”‚     â”‚
    â”‚     â””â”€â”€ ç«  (Chapter)
    â”‚
    â””â”€â”€ å· (Volume)
```

| å±‚çº§ | èŠ‚ç‚¹ç±»å‹ | è¯´æ˜ |
|------|----------|------|
| ç¬¬ä¸€å±‚ | `volume` | å·ï¼Œæœ€é«˜å±‚çº§å®¹å™¨ |
| ç¬¬äºŒå±‚ | `chapter` | ç« ï¼Œå·çš„å­èŠ‚ç‚¹ |
| ç¬¬ä¸‰å±‚ | `section` | å°èŠ‚ï¼Œç« çš„å­èŠ‚ç‚¹ |

### 2. AI å¤§çº²ç”Ÿæˆ

æ ¹æ®é¡¹ç›®è®¾å®šï¼ˆæ ‡é¢˜ã€ç±»å‹ã€é£æ ¼ã€ç®€ä»‹ï¼‰ä¸€é”®ç”Ÿæˆå®Œæ•´å¤§çº²ç»“æ„ï¼š

```
è¾“å…¥: é¡¹ç›®åŸºæœ¬ä¿¡æ¯ + ç”Ÿæˆå‚æ•°
  â†“
AI åˆ†æ: ç†è§£æ•…äº‹ç±»å‹å’Œé£æ ¼
  â†“
è¾“å‡º: å®Œæ•´çš„å·/ç« /èŠ‚ç»“æ„
```

**ç”Ÿæˆå‚æ•°**:
- å·æ•°é‡
- æ¯å·ç« èŠ‚æ•°
- æƒ…èŠ‚å¤æ‚åº¦
- æ˜¯å¦åŒ…å«æè¿°

### 3. AI å¤§çº²ç»­å†™

åŸºäºç°æœ‰å¤§çº²å†…å®¹ï¼Œæ™ºèƒ½ç»­å†™åç»­æƒ…èŠ‚å‘å±•ï¼š

```
è¾“å…¥: ç°æœ‰å¤§çº² + ç»­å†™ä½ç½®
  â†“
AI åˆ†æ: ç†è§£æƒ…èŠ‚èµ°å‘å’Œè§’è‰²å‘å±•
  â†“
è¾“å‡º: åç»­ç« èŠ‚å¤§çº²
```

### 4. æ‹–æ‹½æ’åº

- **åŒçº§æ‹–æ‹½**: è°ƒæ•´åŒä¸€çˆ¶èŠ‚ç‚¹ä¸‹çš„é¡ºåº
- **è·¨çº§æ‹–æ‹½**: å°†èŠ‚ç‚¹ç§»åŠ¨åˆ°ä¸åŒçˆ¶èŠ‚ç‚¹
- **å±‚çº§é™åˆ¶**: è‡ªåŠ¨é™åˆ¶æœ€å¤§ä¸‰å±‚æ·±åº¦

---

## ğŸ—„ï¸ æ•°æ®æ¨¡å‹

### OutlineNode æ¨¡å‹

```python
class OutlineNode(models.Model):
    id = fields.IntField(pk=True)
    project_id = fields.IntField()           # æ‰€å±é¡¹ç›®
    parent_id = fields.IntField(null=True)   # çˆ¶èŠ‚ç‚¹IDï¼ˆnull=æ ¹èŠ‚ç‚¹ï¼‰
    node_type = fields.CharField(max_length=20)  # volume/chapter/section
    title = fields.CharField(max_length=200)     # èŠ‚ç‚¹æ ‡é¢˜
    description = fields.TextField(null=True)    # èŠ‚ç‚¹æè¿°/å¤§çº²å†…å®¹
    position = fields.IntField(default=0)        # åŒçº§æ’åºä½ç½®
    is_expanded = fields.BooleanField(default=True)  # UIå±•å¼€çŠ¶æ€
    created_at = fields.DatetimeField(auto_now_add=True)
    updated_at = fields.DatetimeField(auto_now=True)

    class Meta:
        table = "outline_nodes"
```

### æ ‘çŠ¶ç»“æ„å…³ç³»

```
OutlineNode (parent_id = null)  â† æ ¹èŠ‚ç‚¹ï¼ˆå·ï¼‰
    â”‚
    â””â”€â”€ OutlineNode (parent_id = æ ¹èŠ‚ç‚¹ID)  â† å­èŠ‚ç‚¹ï¼ˆç« ï¼‰
            â”‚
            â””â”€â”€ OutlineNode (parent_id = ç« ID)  â† å­™èŠ‚ç‚¹ï¼ˆå°èŠ‚ï¼‰
```

### ä¸ç« èŠ‚çš„å…³è”

æ¯ä¸ªå¤§çº²èŠ‚ç‚¹å¯ä»¥å…³è”ä¸€ä¸ªç« èŠ‚ï¼ˆChapterï¼‰ï¼Œç”¨äºå°†å¤§çº²ä¸å®é™…å†…å®¹å¯¹åº”ï¼š

```
OutlineNode (chapterç±»å‹)
    â”‚
    â””â”€â”€â†’ Chapter (outline_node_id = OutlineNode.id)
```

---

## ğŸ”Œ API æ¥å£

### åŸºç¡€è·¯å¾„

```
/api/outline
```

### æ¥å£åˆ—è¡¨

| æ–¹æ³• | è·¯å¾„ | è¯´æ˜ |
|------|------|------|
| `GET` | `/project/{project_id}` | è·å–é¡¹ç›®å®Œæ•´å¤§çº²æ ‘ |
| `POST` | `/` | åˆ›å»ºå¤§çº²èŠ‚ç‚¹ |
| `PUT` | `/{node_id}` | æ›´æ–°èŠ‚ç‚¹ä¿¡æ¯ |
| `DELETE` | `/{node_id}` | åˆ é™¤èŠ‚ç‚¹ï¼ˆå«å­èŠ‚ç‚¹ï¼‰ |
| `PUT` | `/{node_id}/move` | ç§»åŠ¨èŠ‚ç‚¹ä½ç½® |
| `POST` | `/generate` | AI ç”Ÿæˆå¤§çº² |
| `POST` | `/continue` | AI ç»­å†™å¤§çº² |

### è¯·æ±‚/å“åº”ç¤ºä¾‹

#### è·å–å¤§çº²æ ‘

**è¯·æ±‚**:
```
GET /api/outline/project/1
```

**å“åº”**:
```json
{
  "nodes": [
    {
      "id": 1,
      "node_type": "volume",
      "title": "ç¬¬ä¸€å· èµ·å§‹",
      "description": "æ•…äº‹çš„å¼€ç«¯...",
      "position": 0,
      "is_expanded": true,
      "children": [
        {
          "id": 2,
          "node_type": "chapter",
          "title": "ç¬¬ä¸€ç«  åˆé‡",
          "description": "ä¸»è§’ä¸å¥³ä¸»çš„ç›¸é‡...",
          "position": 0,
          "children": [...]
        }
      ]
    }
  ]
}
```

#### AI ç”Ÿæˆå¤§çº²

**è¯·æ±‚**:
```json
POST /api/outline/generate
{
  "project_id": 1,
  "volume_count": 3,
  "chapters_per_volume": 10,
  "include_sections": true,
  "complexity": "medium"
}
```

**å“åº”**: æµå¼è¿”å›ç”Ÿæˆçš„å¤§çº²ç»“æ„

#### ç§»åŠ¨èŠ‚ç‚¹

**è¯·æ±‚**:
```json
PUT /api/outline/5/move
{
  "new_parent_id": 2,
  "new_position": 3
}
```

---

## ğŸ–¥ï¸ ç”¨æˆ·äº¤äº’

### å¤§çº²ç¼–è¾‘é¡µé¢

**å¸ƒå±€ç»“æ„**:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  é¡¹ç›®æ ‡é¢˜    [AIç”Ÿæˆ] [AIç»­å†™] [ä¿å­˜]    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚   å¤§çº²æ ‘ç»“æ„     â”‚ â”‚  èŠ‚ç‚¹è¯¦æƒ…ç¼–è¾‘   â”‚ â”‚
â”‚  â”‚                 â”‚ â”‚               â”‚ â”‚
â”‚  â”‚ â–¼ ç¬¬ä¸€å·        â”‚ â”‚ æ ‡é¢˜: ______  â”‚ â”‚
â”‚  â”‚   â–¶ ç¬¬ä¸€ç«       â”‚ â”‚               â”‚ â”‚
â”‚  â”‚   â–¶ ç¬¬äºŒç«       â”‚ â”‚ æè¿°:         â”‚ â”‚
â”‚  â”‚ â–¶ ç¬¬äºŒå·        â”‚ â”‚ ____________  â”‚ â”‚
â”‚  â”‚                 â”‚ â”‚ ____________  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### äº¤äº’æ“ä½œ

| æ“ä½œ | æ–¹å¼ | è¯´æ˜ |
|------|------|------|
| å±•å¼€/æŠ˜å  | ç‚¹å‡»ç®­å¤´ | å±•å¼€æˆ–æŠ˜å å­èŠ‚ç‚¹ |
| é€‰ä¸­èŠ‚ç‚¹ | å•å‡»èŠ‚ç‚¹ | åœ¨å³ä¾§æ˜¾ç¤ºè¯¦æƒ… |
| æ·»åŠ å­èŠ‚ç‚¹ | å³é”®èœå• / + æŒ‰é’® | åœ¨å½“å‰èŠ‚ç‚¹ä¸‹æ·»åŠ å­èŠ‚ç‚¹ |
| åˆ é™¤èŠ‚ç‚¹ | å³é”®èœå• / Delete | åˆ é™¤èŠ‚ç‚¹åŠæ‰€æœ‰å­èŠ‚ç‚¹ |
| æ‹–æ‹½æ’åº | æ‹–æ‹½èŠ‚ç‚¹ | è°ƒæ•´é¡ºåºæˆ–ç§»åŠ¨åˆ°å…¶ä»–çˆ¶èŠ‚ç‚¹ |
| ç¼–è¾‘å†…å®¹ | åŒå‡» / å³ä¾§é¢æ¿ | ç¼–è¾‘æ ‡é¢˜å’Œæè¿° |

### AI ç”Ÿæˆæµç¨‹

```
1. ç‚¹å‡»"AIç”Ÿæˆå¤§çº²"
       â†“
2. é…ç½®ç”Ÿæˆå‚æ•°
   - å·æ•°é‡
   - ç« èŠ‚æ•°é‡
   - å¤æ‚åº¦
       â†“
3. ç¡®è®¤ç”Ÿæˆï¼ˆä¼šæ¸…ç©ºç°æœ‰å¤§çº²ï¼‰
       â†“
4. æµå¼å±•ç¤ºç”Ÿæˆè¿‡ç¨‹
       â†“
5. ç”Ÿæˆå®Œæˆï¼Œå¯ç»§ç»­ç¼–è¾‘
```

### AI ç»­å†™æµç¨‹

```
1. é€‰ä¸­è¦ç»­å†™çš„ä½ç½®
       â†“
2. ç‚¹å‡»"AIç»­å†™"
       â†“
3. é…ç½®ç»­å†™å‚æ•°
   - ç»­å†™ç« èŠ‚æ•°
   - æƒ…èŠ‚æ–¹å‘æç¤º
       â†“
4. æµå¼å±•ç¤ºç»­å†™å†…å®¹
       â†“
5. ç¡®è®¤é‡‡çº³æˆ–ä¿®æ”¹
```

---

## âš™ï¸ æŠ€æœ¯å®ç°

### å‰ç«¯

**è·¯å¾„**: `src/features/novel_outline/frontend/`

| æ–‡ä»¶ | è¯´æ˜ |
|------|------|
| `api.ts` | API è°ƒç”¨å°è£… |
| `pages/OutlinePage.tsx` | å¤§çº²ç¼–è¾‘é¡µé¢ |
| `components/OutlineTree.tsx` | å¤§çº²æ ‘ç»„ä»¶ |
| `components/OutlineNode.tsx` | å•ä¸ªèŠ‚ç‚¹ç»„ä»¶ |
| `components/NodeEditor.tsx` | èŠ‚ç‚¹ç¼–è¾‘é¢æ¿ |

### åç«¯

**è·¯å¾„**: `src/features/novel_outline/backend/`

| æ–‡ä»¶ | è¯´æ˜ |
|------|------|
| `models.py` | OutlineNode æ¨¡å‹ |
| `schemas.py` | Pydantic éªŒè¯æ¨¡å‹ |
| `router.py` | FastAPI è·¯ç”± |
| `services/outline_service.py` | å¤§çº²ä¸šåŠ¡é€»è¾‘ |
| `services/ai_outline_service.py` | AI ç”ŸæˆæœåŠ¡ |

### æ ‘å½¢æ•°æ®å¤„ç†

**æ„å»ºæ ‘ç»“æ„**:
```python
def build_tree(nodes: List[OutlineNode]) -> List[dict]:
    """å°†æ‰å¹³èŠ‚ç‚¹åˆ—è¡¨æ„å»ºä¸ºæ ‘ç»“æ„"""
    node_map = {n.id: {...n, "children": []} for n in nodes}
    tree = []
    for node in nodes:
        if node.parent_id is None:
            tree.append(node_map[node.id])
        else:
            parent = node_map.get(node.parent_id)
            if parent:
                parent["children"].append(node_map[node.id])
    return tree
```

---

## ğŸ”— å…³è”æ–‡æ¡£

- [é¡¹ç›®ç®¡ç†ç³»ç»Ÿ](./project-system.md) - å¤§çº²æ‰€å±çš„é¡¹ç›®
- [ç« èŠ‚ç³»ç»Ÿ](./chapter-system.md) - å¤§çº²èŠ‚ç‚¹å…³è”çš„ç« èŠ‚
- [AI å°è¯´ç”Ÿæˆç³»ç»Ÿ](./ai-generator-system.md) - AI ç”Ÿæˆèƒ½åŠ›
- [è¿”å›æ–‡æ¡£ä¸­å¿ƒ](./README.md)
