# ç« èŠ‚ç³»ç»Ÿ

> ç®¡ç†å°è¯´çš„å…·ä½“ç« èŠ‚å†…å®¹ï¼Œæ”¯æŒç‹¬ç«‹ç¼–è¾‘å’ŒçŠ¶æ€è¿½è¸ª

---

## ğŸ“– ç³»ç»Ÿæ¦‚è¿°

ç« èŠ‚ç³»ç»Ÿè´Ÿè´£ç®¡ç†å°è¯´çš„å…·ä½“å†…å®¹ï¼Œé‡‡ç”¨æ‰å¹³ç»“æ„å­˜å‚¨ç« èŠ‚æ­£æ–‡ã€‚æ¯ä¸ªç« èŠ‚å¯ä»¥ç‹¬ç«‹ç¼–è¾‘ï¼Œä¹Ÿå¯ä»¥ä¸å¤§çº²èŠ‚ç‚¹å…³è”ï¼Œå®ç°ç»“æ„åŒ–åˆ›ä½œã€‚ç³»ç»Ÿæ”¯æŒå¤šç§çŠ¶æ€è¿½è¸ªï¼Œå¸®åŠ©ä½œè€…æ¸…æ™°æŒæ¡åˆ›ä½œè¿›åº¦ã€‚

---

## ğŸ¯ åŠŸèƒ½ç‰¹æ€§

### 1. ç« èŠ‚ç®¡ç†

| åŠŸèƒ½ | è¯´æ˜ |
|------|------|
| åˆ›å»ºç« èŠ‚ | æ–°å»ºç©ºç™½ç« èŠ‚æˆ–ä»å¤§çº²åˆ›å»º |
| ç¼–è¾‘å†…å®¹ | å¯Œæ–‡æœ¬ç¼–è¾‘ï¼Œæ”¯æŒå®æ—¶ä¿å­˜ |
| æ’åºè°ƒæ•´ | é€šè¿‡ `chapter_number` æ§åˆ¶é¡ºåº |
| æ‰¹é‡æ“ä½œ | æ‰¹é‡åˆ é™¤ã€æ‰¹é‡çŠ¶æ€æ›´æ–° |

### 2. å¤§çº²å…³è”

ç« èŠ‚å¯ä»¥ä¸å¤§çº²èŠ‚ç‚¹ï¼ˆOutlineNodeï¼‰å»ºç«‹ä¸€å¯¹ä¸€å…³è”ï¼š

```
OutlineNode (chapter ç±»å‹)
    â”‚
    â””â”€â”€â†’ Chapter
         - outline_node_id = OutlineNode.id
         - è‡ªåŠ¨åŒæ­¥æ ‡é¢˜
         - å†…å®¹ç‹¬ç«‹å­˜å‚¨
```

**å…³è”ä¼˜åŠ¿**:
- ç»“æ„æ¸…æ™°ï¼šå¤§çº²å’Œå†…å®¹å¯¹åº”
- å¯¼èˆªä¾¿æ·ï¼šä»å¤§çº²ç›´æ¥è·³è½¬åˆ°ç« èŠ‚
- è¿›åº¦è¿½è¸ªï¼šå¤§çº²è§†å›¾æ˜¾ç¤ºç« èŠ‚å®ŒæˆçŠ¶æ€

### 3. çŠ¶æ€è¿½è¸ª

| çŠ¶æ€ | å€¼ | è¯´æ˜ |
|------|------|------|
| è‰ç¨¿ | `draft` | æ­£åœ¨ç¼–å†™ï¼Œæœªå®Œæˆ |
| å·²å®Œæˆ | `completed` | ä½œè€…å·²å®Œæˆç¼–å†™ |
| AI ç”Ÿæˆ | `ai_generated` | ç”± AI ç”Ÿæˆçš„å†…å®¹ |

```
draft (è‰ç¨¿)
    â”‚
    â”œâ”€â”€â†’ completed (å·²å®Œæˆ)  â† æ‰‹åŠ¨å®Œæˆ
    â”‚
    â””â”€â”€â†’ ai_generated (AIç”Ÿæˆ) â† AI ç”Ÿæˆ
            â”‚
            â””â”€â”€â†’ completed  â† å®¡æ ¸åæ ‡è®°å®Œæˆ
```

### 4. å­—æ•°ç»Ÿè®¡

- **å•ç« å­—æ•°**: å®æ—¶è®¡ç®—ç« èŠ‚å†…å®¹å­—æ•°
- **ç´¯è®¡ç»Ÿè®¡**: æ±‡æ€»åˆ°é¡¹ç›®æ€»å­—æ•°
- **ç›®æ ‡è¿½è¸ª**: æ”¯æŒè®¾ç½®ç« èŠ‚ç›®æ ‡å­—æ•°

---

## ğŸ—„ï¸ æ•°æ®æ¨¡å‹

### Chapter æ¨¡å‹

```python
class Chapter(models.Model):
    id = fields.IntField(pk=True)
    uuid = fields.UUIDField()                    # å¤–éƒ¨å¼•ç”¨UUID
    project_id = fields.IntField()               # æ‰€å±é¡¹ç›®
    outline_node_id = fields.IntField(null=True) # å…³è”å¤§çº²èŠ‚ç‚¹ï¼ˆå¯é€‰ï¼‰
    title = fields.CharField(max_length=200)     # ç« èŠ‚æ ‡é¢˜
    content = fields.TextField(null=True)        # ç« èŠ‚æ­£æ–‡
    chapter_number = fields.IntField(default=0)  # ç« èŠ‚åºå·
    word_count = fields.IntField(default=0)      # å­—æ•°
    status = fields.CharField(max_length=20, default="draft")  # çŠ¶æ€
    created_at = fields.DatetimeField(auto_now_add=True)
    updated_at = fields.DatetimeField(auto_now=True)

    class Meta:
        table = "chapters"
```

### å…³è”å…³ç³»

```
NovelProject
    â”‚
    â”œâ”€â”€â†’ Chapter (å¤šä¸ª)
    â”‚       â”‚
    â”‚       â””â”€â”€â†’ OutlineNode (å¯é€‰ï¼Œä¸€å¯¹ä¸€)
    â”‚
    â””â”€â”€â†’ chapter_ids (JSON): å­˜å‚¨ç« èŠ‚é¡ºåº
```

---

## ğŸ”Œ API æ¥å£

### åŸºç¡€è·¯å¾„

```
/api/chapter
```

### æ¥å£åˆ—è¡¨

| æ–¹æ³• | è·¯å¾„ | è¯´æ˜ |
|------|------|------|
| `GET` | `/project/{project_id}` | è·å–é¡¹ç›®æ‰€æœ‰ç« èŠ‚ |
| `POST` | `/` | åˆ›å»ºç« èŠ‚ |
| `GET` | `/{chapter_id}` | è·å–ç« èŠ‚è¯¦æƒ… |
| `PUT` | `/{chapter_id}` | æ›´æ–°ç« èŠ‚ |
| `DELETE` | `/{chapter_id}` | åˆ é™¤ç« èŠ‚ |
| `PUT` | `/{chapter_id}/status` | æ›´æ–°ç« èŠ‚çŠ¶æ€ |
| `PUT` | `/{chapter_id}/content` | æ›´æ–°ç« èŠ‚å†…å®¹ï¼ˆè‡ªåŠ¨ä¿å­˜ï¼‰ |
| `POST` | `/from-outline/{node_id}` | ä»å¤§çº²èŠ‚ç‚¹åˆ›å»ºç« èŠ‚ |
| `PUT` | `/reorder` | è°ƒæ•´ç« èŠ‚é¡ºåº |

### è¯·æ±‚/å“åº”ç¤ºä¾‹

#### åˆ›å»ºç« èŠ‚

**è¯·æ±‚**:
```json
POST /api/chapter
{
  "project_id": 1,
  "title": "ç¬¬ä¸€ç«  åˆé‡",
  "chapter_number": 1,
  "outline_node_id": 5
}
```

**å“åº”**:
```json
{
  "id": 1,
  "uuid": "550e8400-e29b-41d4-a716-446655440000",
  "project_id": 1,
  "title": "ç¬¬ä¸€ç«  åˆé‡",
  "content": null,
  "chapter_number": 1,
  "word_count": 0,
  "status": "draft",
  "outline_node_id": 5,
  "created_at": "2026-01-04T12:00:00Z"
}
```

#### æ›´æ–°ç« èŠ‚å†…å®¹

**è¯·æ±‚**:
```json
PUT /api/chapter/1/content
{
  "content": "æ¸…æ™¨çš„é˜³å…‰é€è¿‡çª—å¸˜çš„ç¼éš™..."
}
```

**å“åº”**:
```json
{
  "id": 1,
  "word_count": 15,
  "updated_at": "2026-01-04T12:30:00Z"
}
```

#### è·å–é¡¹ç›®ç« èŠ‚åˆ—è¡¨

**è¯·æ±‚**:
```
GET /api/chapter/project/1?status=draft
```

**å“åº”**:
```json
{
  "chapters": [
    {
      "id": 1,
      "title": "ç¬¬ä¸€ç«  åˆé‡",
      "chapter_number": 1,
      "word_count": 2500,
      "status": "completed"
    },
    {
      "id": 2,
      "title": "ç¬¬äºŒç«  è¯¯ä¼š",
      "chapter_number": 2,
      "word_count": 1800,
      "status": "draft"
    }
  ],
  "total_word_count": 4300
}
```

---

## ğŸ–¥ï¸ ç”¨æˆ·äº¤äº’

### ç« èŠ‚åˆ—è¡¨é¡µé¢

**å¸ƒå±€ç»“æ„**:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  é¡¹ç›®åç§° > ç« èŠ‚ç®¡ç†        [æ–°å»ºç« èŠ‚] [æ‰¹é‡æ“ä½œ]    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ç­›é€‰: [å…¨éƒ¨â–¼] [è‰ç¨¿] [å·²å®Œæˆ] [AIç”Ÿæˆ]             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ â–¡ ç¬¬ä¸€ç«  åˆé‡          2,500å­—  â— å·²å®Œæˆ    â”‚   â”‚
â”‚  â”‚   æœ€åç¼–è¾‘: 2026-01-04 12:30                â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚ â–¡ ç¬¬äºŒç«  è¯¯ä¼š          1,800å­—  â—‹ è‰ç¨¿      â”‚   â”‚
â”‚  â”‚   æœ€åç¼–è¾‘: 2026-01-04 14:20                â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ç« èŠ‚ç¼–è¾‘é¡µé¢

**å¸ƒå±€ç»“æ„**:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â† è¿”å›  ç¬¬ä¸€ç«  åˆé‡  [çŠ¶æ€: è‰ç¨¿â–¼]  [ä¿å­˜] [AIç»­å†™]â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                                             â”‚   â”‚
â”‚  â”‚          ç« èŠ‚å†…å®¹ç¼–è¾‘åŒº                      â”‚   â”‚
â”‚  â”‚                                             â”‚   â”‚
â”‚  â”‚  æ¸…æ™¨çš„é˜³å…‰é€è¿‡çª—å¸˜çš„ç¼éš™...                 â”‚   â”‚
â”‚  â”‚                                             â”‚   â”‚
â”‚  â”‚                                             â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  å­—æ•°: 2,500 / ç›®æ ‡: 3,000    è‡ªåŠ¨ä¿å­˜: 12:30:45   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### äº¤äº’æ“ä½œ

| æ“ä½œ | æ–¹å¼ | è¯´æ˜ |
|------|------|------|
| æ–°å»ºç« èŠ‚ | ç‚¹å‡»æŒ‰é’® | å¼¹å‡ºåˆ›å»ºå¯¹è¯æ¡† |
| ç¼–è¾‘ç« èŠ‚ | ç‚¹å‡»ç« èŠ‚ | è¿›å…¥ç¼–è¾‘é¡µé¢ |
| åˆ‡æ¢çŠ¶æ€ | ä¸‹æ‹‰èœå• | å¿«é€Ÿåˆ‡æ¢ç« èŠ‚çŠ¶æ€ |
| åˆ é™¤ç« èŠ‚ | å³é”®/æŒ‰é’® | ç¡®è®¤ååˆ é™¤ |
| æ‹–æ‹½æ’åº | æ‹–æ‹½è¡Œ | è°ƒæ•´ç« èŠ‚é¡ºåº |
| è‡ªåŠ¨ä¿å­˜ | è‡ªåŠ¨ | ç¼–è¾‘æ—¶è‡ªåŠ¨ä¿å­˜ï¼ˆé˜²æŠ–ï¼‰ |

### ä»å¤§çº²åˆ›å»ºç« èŠ‚

```
1. åœ¨å¤§çº²ç³»ç»Ÿä¸­é€‰ä¸­ chapter ç±»å‹èŠ‚ç‚¹
       â†“
2. ç‚¹å‡»"åˆ›å»ºç« èŠ‚"
       â†“
3. è‡ªåŠ¨åˆ›å»ºå…³è”ç« èŠ‚
   - æ ‡é¢˜åŒæ­¥å¤§çº²èŠ‚ç‚¹æ ‡é¢˜
   - å»ºç«‹ outline_node_id å…³è”
       â†“
4. è·³è½¬åˆ°ç« èŠ‚ç¼–è¾‘é¡µé¢
```

---

## âš™ï¸ æŠ€æœ¯å®ç°

### å‰ç«¯

**è·¯å¾„**: `src/features/chapter/frontend/`

| æ–‡ä»¶ | è¯´æ˜ |
|------|------|
| `api.ts` | API è°ƒç”¨å°è£… |
| `pages/ChapterListPage.tsx` | ç« èŠ‚åˆ—è¡¨é¡µ |
| `pages/ChapterEditPage.tsx` | ç« èŠ‚ç¼–è¾‘é¡µ |
| `components/ChapterEditor.tsx` | ç¼–è¾‘å™¨ç»„ä»¶ |
| `components/ChapterCard.tsx` | ç« èŠ‚å¡ç‰‡ç»„ä»¶ |
| `hooks/useAutoSave.ts` | è‡ªåŠ¨ä¿å­˜ Hook |

### åç«¯

**è·¯å¾„**: `src/features/chapter/backend/`

| æ–‡ä»¶ | è¯´æ˜ |
|------|------|
| `models.py` | Chapter æ¨¡å‹ |
| `schemas.py` | Pydantic éªŒè¯æ¨¡å‹ |
| `router.py` | FastAPI è·¯ç”± |
| `services/chapter_service.py` | ç« èŠ‚ä¸šåŠ¡é€»è¾‘ |
| `services/word_count_service.py` | å­—æ•°ç»Ÿè®¡æœåŠ¡ |

### è‡ªåŠ¨ä¿å­˜å®ç°

```typescript
// useAutoSave.ts
const useAutoSave = (content: string, onSave: Function) => {
  const debouncedSave = useDebouncedCallback(
    async (content) => {
      await onSave(content)
    },
    2000 // 2ç§’é˜²æŠ–
  )

  useEffect(() => {
    if (content) {
      debouncedSave(content)
    }
  }, [content])
}
```

### å­—æ•°ç»Ÿè®¡

```python
def count_words(content: str) -> int:
    """ç»Ÿè®¡ä¸­æ–‡å­—æ•°ï¼ˆå«æ ‡ç‚¹ï¼‰"""
    if not content:
        return 0
    # ç§»é™¤ç©ºç™½å­—ç¬¦åè®¡ç®—é•¿åº¦
    return len(content.replace(" ", "").replace("\n", ""))
```

---

## ğŸ”— å…³è”æ–‡æ¡£

- [é¡¹ç›®ç®¡ç†ç³»ç»Ÿ](./project-system.md) - ç« èŠ‚æ‰€å±çš„é¡¹ç›®
- [å¤§çº²ç³»ç»Ÿ](./outline-system.md) - ç« èŠ‚å…³è”çš„å¤§çº²
- [AI å°è¯´ç”Ÿæˆç³»ç»Ÿ](./ai-generator-system.md) - AI ç”Ÿæˆç« èŠ‚å†…å®¹
- [è¿”å›æ–‡æ¡£ä¸­å¿ƒ](./README.md)
