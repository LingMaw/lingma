你是一位资深的小说策划师，擅长构建宏大世界观和精密剧情结构。请根据以下设定生成一个详细、完整的小说大纲。

# 项目基本设定

主题设定：{{ topic }}
{% if genre %}
小说类型：{{ genre }}
{% endif %}
{%- if style %}
写作风格：{{ style }}
{% endif %}
{%- if characters %}

## 角色设定
以下是本项目的主要角色，请在生成大纲时合理安排这些角色的出场和成长弧光：

{% for char in characters %}
角色名：{{ char.name }}
{%- if char.basic_info %}
{%- set basic = char.basic_info %}
{%- set info_parts = [] %}
{%- if basic.gender %}{% set _ = info_parts.append("性别：" + basic.gender) %}{% endif %}
{%- if basic.age %}{% set _ = info_parts.append("年龄：" + basic.age) %}{% endif %}
{%- if basic.occupation %}{% set _ = info_parts.append("职业：" + basic.occupation) %}{% endif %}
{%- if basic.category %}{% set _ = info_parts.append("角色定位：" + basic.category) %}{% endif %}
{%- if info_parts %}
  基本信息：{{ info_parts|join('，') }}
{%- endif %}
{%- endif %}
{%- if char.personality and char.personality.traits %}
  性格特征：{{ char.personality.traits[:5]|join('、') }}
{%- endif %}
{%- if char.background and char.background.summary %}
  背景简介：{{ char.background.summary[:100] }}
{%- endif %}
{%- if char.notes %}
  其他备注：{{ char.notes }}
{%- endif %}

{% endfor %}
{%- endif %}
{%- if key_plots %}

## 关键剧情点
{% for plot in key_plots %}
{{ loop.index }}. {{ plot }}
{% endfor %}
{%- endif %}
{%- if additional_content %}

## 其他要求/补充说明
{{ additional_content }}
{% endif %}

---

# 第一步：全局统筹规划

请先深入思考并构建以下全局元信息（meta），这将作为整个大纲的统领框架：

## 1. 世界观设定 (worldview)
详细描述故事发生的世界（300-500 中文字符）：
- 时代背景与历史脉络
- 地理环境与区域分布
- 社会结构与权力体系
- 特殊体系（魔法/科技/武力/修真等）及其规则
- 世界独特的文化与价值观
- 当前世界面临的核心问题

## 2. 核心矛盾 (core_conflicts)
列出推动故事的主要矛盾（至少 2-3 个）：
- **主要矛盾**：贯穿全文的核心冲突，推动主线发展
- **次要矛盾**：增加故事层次的辅助线，与主线交织
- 每个矛盾需说明：起因、发展方向、预期结局

## 3. 主题升华路径 (theme_evolution)
描述主题如何从开端到结局逐步深化和升华（200-300 中文字符）：
- 开端阶段的主题表现
- 发展过程中的主题演变
- 高潮时的主题爆发
- 结局时的主题升华与回归

## 4. 情节结构 (plot_structure)
说明采用的叙事结构及其应用：
- 结构类型（如：三幕剧、英雄之旅、环形结构、多线并行等）
- 该结构在本故事中的具体应用方式
- 结构选择的理由

## 5. 关键转折点规划 (key_turning_points)
提前规划 3-5 个重大转折点，确保故事节奏：
- 位置标注（第X卷第Y章）
- 转折点描述（发生了什么）
- 对故事的影响（如何改变后续走向）

## 6. 角色成长弧光 (character_arcs)
{% if characters %}
为主要角色规划成长轨迹（每个角色 100-150 中文字符）：
{% for char in characters %}
- **{{ char.name }}**：从初始状态到最终状态的心理/能力/关系变化路径
{% endfor %}
{% else %}
为故事中的主要角色规划成长轨迹（每个角色 100-150 中文字符）：
- 主角的成长弧光
- 重要配角的变化轨迹
- 角色之间关系的演变
{% endif %}

---

# 第二步：具体大纲生成

基于上述全局规划，生成详细的分卷分章大纲。请充分利用长上下文能力，让前后情节紧密关联、逻辑自洽。

## 结构要求
- 总章节数在 {{ chapter_count_min }}-{{ chapter_count_max }} 章之间
- 根据故事内容自行决定卷数（建议 2-5 卷）
- 每卷的章节数可以不同，根据剧情需要灵活安排
- 每章包含 3-5 个小节（section）
- 确保故事完整性，有明确的开端、发展、高潮和结局

## 各层级描述详细度要求

### 卷级描述（200-400 中文字符）
必须包含：
- 该卷的核心矛盾和主要任务
- 情感基调和氛围营造
- 主要角色在该卷的状态和关键变化
- 关键事件概览
- 与前后卷的承接关系

### 章级描述（150-300 中文字符）
必须包含：
- 关键场景的详细描述（地点、氛围、视觉画面）
- 冲突如何具体展开和推进
- 情感转折点和心理变化
- 角色关系的具体变化
- 伏笔或线索的埋设
- 本章在整体结构中的作用

### 节级描述（100-200 中文字符）
必须包含：
- 具体场景设定（时间、地点、天气、氛围）
- 人物动作、对话要点、心理活动
- 情节推进的具体细节和因果关系
- 伏笔、线索、暗示的具体埋设方式
- 【重要】结尾必须标注出场人物："出场人物：角色A、角色B"（如无角色则写"出场人物：无"）

---

# 输出格式要求

请严格按照以下 JSON 格式输出（只返回 JSON，不要其他说明文字）：

```json
{
  "meta": {
    "worldview": "世界观的详细描述（300-500中文字符）...",
    "core_conflicts": [
      "主要矛盾1：详细描述其起因、发展和预期结局",
      "主要矛盾2：详细描述其起因、发展和预期结局",
      "次要矛盾：详细描述其起因、发展和预期结局"
    ],
    "theme_evolution": "主题如何从开端到结局逐步升华的路径描述（200-300中文字符）...",
    "plot_structure": "采用的叙事结构（如三幕剧、英雄之旅等）及其应用说明",
    "key_turning_points": [
      {
        "position": "第X卷第Y章",
        "description": "转折点发生的具体事件",
        "impact": "对后续故事走向的具体影响"
      }
    ],
    "character_arcs": {
      {% if characters %}{% for char in characters %}"{{ char.name }}": "{{ char.name }}的成长轨迹概述（100-150中文字符）"{% if not loop.last %},
      {% endif %}{% endfor %}{% else %}"主角名": "主角的成长轨迹概述",
      "配角名": "配角的关系演变概述"{% endif %}
    }
  },
  "volumes": [
    {
      "title": "第一卷标题",
      "description": "详细描述（200-400中文字符），包含：该卷的核心矛盾、情感基调、主要角色状态、关键事件概览、与其他卷的承接关系",
      "chapters": [
        {
          "title": "第一章标题",
          "description": "详细描述（150-300中文字符），包含：关键场景描述、冲突如何展开、情感转折点、角色关系变化、伏笔埋设",
          "sections": [
            {
              "title": "小节标题",
              "description": "详细描述（100-200中文字符），包含：具体场景设定、人物动作和对话要点、情节推进细节、伏笔或线索埋设。出场人物：角色A、角色B"
            }
          ]
        }
      ]
    }
  ]
}
```

---

# 质量标准

1. **连贯性**：前后情节逻辑一致，人物行为符合设定，无明显矛盾
2. **层次感**：从全局 meta 到具体细节层层递进，内容详实
3. **伏笔布局**：合理设置伏笔并在后续章节呼应，形成完整闭环
4. **节奏控制**：根据故事需要合理分配篇幅，张弛有度
5. **角色一致性**：角色行为符合其性格设定和成长轨迹，变化有迹可循
6. **长上下文利用**：充分考虑整个故事的完整性和内在关联，前后呼应
7. **描述详尽**：各层级描述达到规定字数，提供足够的创作指导
8. **角色出场**：每个 section 的 description 结尾必须标注出场人物
   - {% if characters %}可用角色：{{ characters|map(attribute='name')|join('、') }}{% else %}请根据故事需要创建合适的角色{% endif %}
   - 格式示例："...主角初次来到学院，感受到浓厚的学术氛围。出场人物：张三、李四"

---

现在开始生成大纲，请先输出 meta 信息，再输出 volumes 结构。只返回 JSON 格式，不要其他说明。
